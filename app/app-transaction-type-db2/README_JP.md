# DB2 を使用したトランザクションタイプ管理 - CardDemo 拡張機能

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![License](https://img.shields.io/badge/license-Apache%202.0-green.svg)

## 概要

トランザクションタイプ管理モジュールは、埋め込み静的 SQL を使用した DB2 統合パターンを示す CardDemo アプリケーションのオプションの拡張機能です。このモジュールにより、管理者は DB2 テーブルでトランザクションタイプ参照データを維持でき、既存の VSAM ベースのトランザクション処理システムと統合しながら、トランザクションメタデータを管理するためのより堅牢でリレーショナルなアプローチを提供します。

## 目次

- [機能](#機能)
- [コンポーネント](#コンポーネント)
- [インストール](#インストール)
- [使用方法](#使用方法)
- [技術詳細](#技術詳細)
- [基本アプリケーションとの統合](#基本アプリケーションとの統合)
- [依存関係](#依存関係)

## 機能

この拡張機能は以下の機能を提供します：

- **トランザクションタイプ管理**: CICS トランザクションを通じてトランザクションタイプを追加、更新、または削除します
- **バッチ管理**: バッチジョブを通じてトランザクションタイプを維持し、VSAM統合のためのデータを抽出します
- **DB2 統合**: 以下を含むさまざまな DB2 統合パターンを示します：
  - ホスト変数を使用した静的埋め込み SQL
  - 前方および後方カーソル処理
  - 標準的な CRUD 操作 (作成、読み取り、更新、削除)
  - CICS 環境での DB2 プリコンパイラ統合
  - SQLCA による適切なエラー処理

## コンポーネント

### オンラインコンポーネント

| トランザクション | BMS マップ | プログラム | 機能 | 備考 |
|:---|:---|:---|:---|:---|
| CTTU | COTRTUP | COTRTUPC | トランザクションタイプ追加/編集 | 静的埋め込み SQL を使用した追加および更新操作 |
| CTLI | COTRTLI | COTRTLIC | トランザクションタイプ一覧/更新/削除 | 前方/後方カーソルと削除操作のデモ |

### バッチコンポーネント

| ジョブ | プログラム | 機能 |
|:---|:---|:---|
| CREADB21 | DSNTEP4 | CardDemo DB2 データベースの作成とテーブルのロード |
| TRANEXTR | DSNTIAUL | トランザクションタイプの最新 DB2 データを抽出し、VSAM 互換ファイルを作成 |
| MNTTRDB2 | COBTUPDT | トランザクションタイプ更新用のバッチ保守プログラム |

### ディレクトリ構造

- **bms/**: トランザクション画面の BMS マップ定義
- **cbl/**: トランザクション処理用の COBOL プログラム
- **cpy/**: データ構造用のコピーブック
- **cpy-bms/**: BMS マップ用のコピーブック
- **csd/**: CICS リソース定義
- **dcl/**: DB2 宣言
- **ddl/**: DB2 テーブル定義
- **jcl/**: バッチ操作用の JCL
- **ctl/**: DB2 操作用のコントロールファイル

## インストール

### 前提条件

- 基本となる CardDemo アプリケーションがインストールされ動作していること
- DB2 サブシステムが構成されアクセス可能であること
- DB2 サポートを備えた CICS

### インストール手順

1. **DB2 オブジェクトの作成**
   - CREADB21 ジョブを実行して、必要な DB2 テーブルを作成します

2. **プログラムのコンパイル**
   - DB2 プリコンパイラサポートを使用して COBOL プログラムをコンパイルします

3. **CICS リソースの定義**
   - 提供された CSD 定義を使用して、トランザクションを CICS リージョンに追加します：

     ```
     DEFINE TRANSACTION(CTTU) GROUP(CARDDEMO) PROGRAM(COTRTUPC)
     DEFINE TRANSACTION(CTLI) GROUP(CARDDEMO) PROGRAM(COTRTLIC)
     ```

4. **初期データの抽出**
   - TRANEXTR ジョブを実行して、DB2 からトランザクションタイプデータを抽出します

5. **管理メニューオプションの有効化**
   - これで、管理メニュー (CA00) でトランザクションタイプ管理オプション (5 および 6) が利用可能になります
   - オプション 5: トランザクションタイプ一覧/更新/削除 (CTLI)
   - オプション 6: トランザクションタイプ追加/編集 (CTTU)

## 使用方法

### オンライントランザクションタイプ管理

1. 管理アカウントを使用して CardDemo にログインし、管理メニューにアクセスします (例: ADMIN001/PASSWORD)
2. オプション '5' を選択して、トランザクションタイプを一覧表示/更新/削除します (CTLI)
   - 前方/後方ページングを使用してトランザクションタイプを参照
   - トランザクションの説明をインラインで更新
   - トランザクションタイプの削除 (参照整合性チェックあり)
3. オプション '6' を選択して、トランザクションタイプを追加/編集します (CTTU)
   - 新しいトランザクションタイプの追加
   - 既存のトランザクションタイプの説明を編集

### バッチトランザクションタイプ管理

MNTTRDB2 ジョブを実行して、トランザクションタイプのバッチ保守を実行します。このジョブは、COBTUPDT プログラムを使用してバッチモードでトランザクションタイプ情報を更新します。

## 技術詳細

### DB2 テーブル

この拡張機能は、以下の DB2 テーブルを使用します：

- **CARDDEMO.TRANSACTION_TYPE**: トランザクションタイプ情報を格納
  - TR_TYPE (CHAR(2)): トランザクションタイプコード (主キー)
  - TR_DESCRIPTION (VARCHAR(50)): トランザクション説明

- **CARDDEMO.TRANSACTION_TYPE_CATEGORY**: トランザクションカテゴリ情報を格納
  - TRC_TYPE_CODE (CHAR(2)): トランザクションタイプコード (主キー、TRANSACTION_TYPE.TR_TYPE への外部キー)
  - TRC_TYPE_CATEGORY (CHAR(4)): トランザクションカテゴリコード (主キー)
  - TRC_CAT_DATA (VARCHAR(50)): カテゴリ説明
  - 外部キー: TRC_TYPE_CODE は TRANSACTION_TYPE.TR_TYPE を参照 (DELETE RESTRICT)

### 統合パターン

この拡張機能は、いくつかの DB2 統合パターンを示します：

1. **静的埋め込み SQL**: すべてのプログラムは、パラメータ受け渡し用のホスト変数を使用して、COBOL コードに埋め込まれた静的 SQL ステートメントを使用します
2. **カーソル処理**: CTLI トランザクションは、DB2 カーソルを使用して、前方および後方ページング機能を使用して結果セットをナビゲートする方法を示します
3. **CRUD 操作**: 埋め込み SQL を使用した完全な作成、読み取り、更新、削除操作
4. **トランザクション管理**: SQLCA エラーチェックを使用した CICS 環境での適切なコミット/ロールバック処理を示します
5. **DB2 プリコンパイラ統合**: CICS 環境での DB2 プリコンパイラの使用を示します
6. **ホスト変数の使用**: COBOL と DB2 間のデータ交換のための COBOL ホスト変数の適切な使用

## 基本アプリケーションとの統合

このモジュールは、以下の方法で基本 CardDemo アプリケーションと統合します：

1. **データ同期**: TRANEXTR ジョブは、DB2 からトランザクションタイプデータを抽出し、基本アプリケーションのトランザクション処理で使用できる VSAM 互換ファイルを作成します
2. **管理メニュー統合**: トランザクションタイプ管理用に管理メニュー (CA00) にオプション 5 および 6 を追加します
3. **参照データ管理**: VSAM ベースのトランザクション処理システムに供給されるトランザクションタイプ参照データを管理するための一元化された方法を提供します
4. **デュアルストレージ戦略**: DB2 (管理機能用) と VSAM (高性能トランザクション処理用) の両方でトランザクションタイプを維持します

## 依存関係

- 基本 CardDemo アプリケーション
- DB2 サブシステム
- DB2 サポートを備えた CICS

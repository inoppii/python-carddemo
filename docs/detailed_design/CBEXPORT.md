# CBEXPORT 詳細設計書

## 1. 概要

`CBEXPORT` は、拠点移行（Branch Migration）のために、顧客、アカウント、カード、取引履歴などの全関連データを一つの統合ファイル (`EXPFILE`) にエクスポートするバッチプログラムです。

## 2. プログラム情報

- **プログラム ID**: `CBEXPORT`
- **作成者**: CARDDEMO TEAM
- **タイプ**: BATCH COBOL Program
- **関連 JCL**: `EXPORT.jcl` (想定)

## 3. 入出力定義

### 3.1. 入力ファイル (全件読込)

- **CUSTOMER-INPUT**: 顧客マスタ (`CUSTFILE`)
- **ACCOUNT-INPUT**: アカウントマスタ (`ACCTFILE`)
- **XREF-INPUT**: クロスリファレンスマスタ (`XREFFILE`)
- **TRANSACTION-INPUT**: 取引履歴ファイル (`TRANSACT`)
- **CARD-INPUT**: カードマスタ (`CARDFILE`)

### 3.2. 出力ファイル

- **EXPORT-OUTPUT**: 拠点移行用エクスポートファイル (`EXPFILE`)。固定長 500 バイト。

## 4. 処理ロジック詳細

### 4.1. データ統合ロジック

本プログラムは、各入力ファイルを順番に全件読み込み、特定のレコード種別コードを付与して単一の出力ファイルにまとめます。

- **レコード種別コード**:
  - `C`: Customer (顧客)
  - `A`: Account (アカウント)
  - `X`: Xref (クロスリファレンス)
  - `T`: Transaction (取引)
  - `D`: Card (カード)

### 4.2. 共通ヘッダー情報

各エクスポートレコードには、以下の共通情報が付加されます。

- 時刻スタンプ (`WS-FORMATTED-TIMESTAMP`): 26 バイト。
- シーケンス番号 (`WS-SEQUENCE-COUNTER`): 9 桁。
- 拠点 ID (`EXPORT-BRANCH-ID`): デフォルト '0001'。
- リージョンコード (`EXPORT-REGION-CODE`): デフォルト 'NORTH'。

### 4.3. 統計レポート

処理の最後に、各カテゴリごとのエクスポート件数と合計件数を標準出力に表示し、データの整合性確認に使用します。

## 5. エラーハンドリング

- いずれかのファイルのオープンまたは読込に失敗した場合は、エラー詳細を表示してアベンド (`CEE3ABD`) します。

## 6. 特記事項

- 出力ファイルはシーケンス番号をキーとした索引ファイル (VSAM KSDS 形式のシミュレート) として定義されています。
- このプログラムは `CBIMPORT` と対になって機能することを前提として設計されています。

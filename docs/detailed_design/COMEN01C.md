# COMEN01C 詳細設計書

## 1. 概要

`COMEN01C` は、一般ユーザー向けのメインメニュー画面を提供する CICS オンラインプログラムです。ユーザーが選択したオプションに基づき、アカウント管理、カード管理、取引照会などの各種子画面へ制御を遷移させます。

## 2. プログラム情報

- **プログラム ID**: `COMEN01C`
- **作成者**: AWS
- **タイプ**: CICS COBOL, BMS
- **トランザクション ID**: `CM00`
- **マップセット**: `COMEN01`
- **マップ名**: `COMEN1A`

## 3. 入出力定義

### 3.1. 画面 (BMS)

- **マップセット**: `COMEN01`
- **主要フィールド**:
  - `OPTIONI`: 選択メニュー番号入力。
  - メニュー項目一覧（表示専用）: 下記の機能を選択可能（`COMEN02Y` コピー句に基づく）。
        1. Account View
        2. Account Update
        3. Credit Card List
        4. Credit Card View
        5. Credit Card Update
        6. Transaction List
        7. Transaction View
        8. Bill Payment
        9. Reports

### 3.2. コピー句 (`COMEN02Y`)

- メニューの各オプションに対応するプログラム名が定義されている。

## 4. 処理ロジック詳細

### 4.1. 初期表示

- ログインセッション (`COMMAREA`) を確認。
- 画面を初期化し、ユーザーに選択を促す。

### 4.2. オプション選択処理 (`PROCESS-ENTER-KEY`)

1. **入力取得**: 画面から `OPTIONI` を受け取る。
2. **範囲チェック**: 入力値が定義された範囲（例：1〜9）に入っているか。
3. **権限チェック**: 現在のユーザータイプで実行可能な機能か（コピー句の `CDEMO-MENU-OPT-USRTYPE` で判定）。
4. **プログラム特定**: `COMEN02Y` から該当する `PGMNAME` を取得。

### 4.3. 制御遷移

- `EXEC CICS XCTL` を使用して、選択されたプログラムへ COMMAREA を渡して遷移。

## 5. エラーハンドリング

- 無効なメニュー番号が入力された場合、「Invalid Option」メッセージを表示。
- COMMAREA が正しく設定されていない（＝ログインを介していない）場合の不正アクセス制御。

## 6. 特記事項

- メニュー構成はコピー句 `COMEN02Y` で一元管理されており、機能の追加や変更に対応しやすい設計となっている。
- 遷移先から戻ってきた際の状態維持のため、COMMAREA の内容を適切に管理している。

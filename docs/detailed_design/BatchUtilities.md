# バッチ共通ユーティリティ 詳細設計概要

## 1. 概要

本プロジェクトのバッチ処理で使用される、汎用的なユーティリティプログラムおよびサブルーチンの設計概要を以下に示します。

## 2. ユーティリティ一覧

### 2.1. CSUTLDTC (日付検証・変換)

- **役割**: IBM Language Environment (LE) API である `CEEDAYS` を呼び出し、日付形式の検証と Lilian 形式（1582年10月14日からの経過日数）への変換を行います。
- **インターフェース**: `PROCEDURE DIVISION USING LS-DATE, LS-DATE-FORMAT, LS-RESULT.`
- **エラー処理**: 不正な日付形式や範囲外の日付が渡された場合、LE からのフィードバックコードを解析し、具体的なエラーメッセージ (`WS-RESULT`) と戻り値を返します。

### 2.2. COBSWAIT (待機処理)

- **役割**: 指定された時間（センチ秒、1/100秒単位）だけプログラムの実行を一時停止させます。
- **インターフェース**: `SYSIN` から待機時間を読み込み、システムルーチン `MVSWAIT` を呼び出します。
- **用途**: 他のジョブの完了待ちや、リソースの競合を避けるためのタイマーとしてバッチジョブ内で使用されます。

### 2.3. CBSTM03B (I/O 抽象化サブルーチン)

- **役割**: `CBSTM03A` (ステートメント生成) から呼び出され、VSAM ファイルへのアクセスの抽象化を行います。
- **対応 DD 名**: `TRNXFILE`, `XREFFILE`, `CUSTFILE`, `ACCTFILE`
- **サポート操作**:
  - `O`: Open
  - `C`: Close
  - `R`: Read (Sequential)
  - `K`: Read (Key Access)
- **利点**: 呼び出し側プログラムがファイルの物理構造やステータスコードを意識せず、統一的なインターフェースでデータアクセスを行うことができます。

## 3. 特記事項

- これらのプログラムは単体では動作せず、他のバッチプログラムや JCL ステップから呼び出されることを前提としています。
- メメインフレーム固有のシステム呼び出し（`CEEDAYS`, `MVSWAIT`）が含まれており、クラウド移行時にはこれらの環境に応じたエミュレーションや再実装が必要となります。

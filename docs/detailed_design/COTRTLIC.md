# COTRTLIC 詳細設計書

## 1. 概要

- **プログラムID**: COTRTLIC
- **論理層**: Business Logic
- **機能**: トランザクションタイプの一覧照会、更新・削除のための選択機能を提供します。
- **特徴**: DB2 カーソルを使用したページング処理を実装しています。

## 2. 入出力

### 入力

- **BMSマップ**: `CTRTLIA` (Mapset: `COTRTLI`)
  - 検索条件: トランザクションタイプコード、説明 (フィルタリング用)
  - アクション選択: 更新(`U`)、削除(`D`)
- **Commarea**: `CARDDEMO-COMMAREA`
  - 遷移元プログラムからのコンテキスト情報 (ユーザー種別、戻り先など)

### 出力

- **BMSマップ**: `CTRTLIA`
  - トランザクションタイプの一覧 (ページング表示)
  - 処理結果メッセージ

## 3. 外部仕様

### 画面

- **マップセット**: `COTRTLI`
- **マップ**: `CTRTLIA`
- **機能**:
  - 一覧表示: 1ページあたり7件表示
  - PFキー:
    - `F3`: 終了 (メインメニューまたは呼び出し元へ戻る)
    - `F7`: 前ページ
    - `F8`: 次ページ
    - `Enter`: 検索実行 / 選択したアクションの確認
    - `F10`: 削除/更新の確定 (選択後)

### データベース

- **テーブル**: `CARDDEMO.TRANSACTION_TYPE` (読み取り)
  - `TR_TYPE`: トランザクションタイプコード (主キー)
  - `TR_DESCRIPTION`: 説明

### 呼び出し関係

- **Called By**:
  - `COMEN01C` (メインメニュー: 管理者用オプション '06' 等)
  - `COTRTUPC` (更新・追加画面からの戻り)
- **Calls**:
  - `COTRTUPC`: 新規追加(`Add`) または 一覧で `U`(Update) 選択時

## 4. 主要ロジック

### 初期処理 (`0000-MAIN`, `Initial Entry`)

- Commarea の有無をチェックし、初回起動か再入かを判定。
- 初回起動時は検索条件の初期化、ページング変数の初期化を行う。

### 入力処理 (`1000-RECEIVE-MAP`)

- マップから入力を受け取る。
- PF キーの判定 (`0001-CHECK-PFKEYS`)。
  - `F3`: 終了処理。
  - `F7`/`F8`: ページング指示。
  - `Enter`: 検索または選択アクションのバリデーション。

### データ取得 (`Use of Cursors`)

- DB2 カーソル `C-TR-TYPE-FORWARD` および `C-TR-TYPE-BACKWARD` を使用。
- 検索条件 (`TR_TYPE`, `TR_DESCRIPTION`) に基づき `LIKE` 検索や範囲検索を行う。
- 指定された開始キー (`WS-START-KEY`) から 7 件分をフェッチして画面配列に格納。

### アクション分岐 (`2000-DECIDE-ACTION` ※想定)

- 一覧上で `U` が入力された場合、対象のキーを Commarea に設定して `COTRTUPC` へ `XCTL` (遷移) する。
- 一覧上で `D` が入力された場合、確認メッセージを表示し、`F10` で削除を実行する (本プログラム内で削除 SQL を発行するか、更新プログラムへ移譲するかは実装依存だが、ソース上 `COTRTUPC` への遷移が主の模様 ※要詳細確認: ソース内 `WS-INFORM-DELETE` などがあるため、簡易削除機能を持つ可能性あり)。
  - *補足*: ソースコード内に `DELETE` 文が見当たらない場合、削除も `COTRTUPC` へ委譲している可能性があるが、`WS-INFORM-DELETE` メッセージがあることから、画面上での確認フローが存在する。実際の削除ロジックは `COTRTUPC` に集約されているパターンが多い。

### 終了処理

- `F3`押下時、管理メニュー (`COADM01C`) へ戻る。

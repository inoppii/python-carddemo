# COSGN00C 詳細設計書

## 1. 概要

`COSGN00C` は、CardDemo アプリケーションのログイン（サインオン）を制御するプログラムです。ユーザー ID とパスワードを入力し、`USRSEC` ファイルに照らして認証を行います。認証成功後、ユーザー権限に応じて「管理者メニュー」または「一般ユーザーメニュー」へ遷移します。

## 2. プログラム情報

- **プログラム ID**: `COSGN00C`
- **作成者**: AWS
- **タイプ**: CICS COBOL, VSAM, BMS
- **トランザクション ID**: `SIGN` (通常 CICS デフォルトだが本環境では `CO00` などが割り当てられる可能性がある)
- **マップセット**: `COSGN00`
- **マップ名**: `COSGN0A`

## 3. 入出力定義

### 3.1. 画面 (BMS)

- **マップセット**: `COSGN00`
- **主要フィールド**:
  - `USERIDI`: ユーザー ID 入力。
  - `PASSWDL`: パスワード入力（非表示設定が推奨される）。
  - `ERRMSGO`: エラーメッセージ表示エリア。

### 3.2. VSAM ファイル

- **USRSEC**: ユーザー情報とパスワードを保持するマスタファイル。

### 3.3. COMMAREA

- `CARDDEMO-COMMAREA`: セッション情報（ユーザータイプ、ログイン状態など）を後続プログラムに引き継ぐために初期化・設定される。

## 4. 処理ロジック詳細

### 4.1. 初期表示

- `EIBCALEN = 0` (直接起動) の場合、セッションエリアを初期化し、空のサインオン画面を表示。

### 4.2. 認証処理 (`PROCESS-ENTER-KEY`)

1. **入力チェック**: ユーザー ID とパスワードが入力されているか。
2. **ファイル照会**: `USRSEC` から入力 ID をキーにレコードを `READ`。
3. **照合**:
    - レコード不在の場合、「User not found」エラー。
    - パスワード不一致の場合、「Wrong Password」エラー。
4. **セッション設定**:
    - 認証成功時、`SEC-USR-TYPE` (Admin/Regular) を COMMAREA にセット。
    - `CDEMO-USER-ID` をセット。

### 4.3. 処理遷移

- **管理者 (`SEC-USR-TYPE = 'A'`)**: `COADM01C` (Admin Menu) へ `XCTL`。
- **一般ユーザー (`SEC-USR-TYPE = 'R'`)**: `COMEN01C` (Main Menu) へ `XCTL`。

## 5. エラーハンドリング

- ファイルアクセスエラー時の汎用メッセージ表示。
- 不正なログイン試行に対するフィードバック。

## 6. 特記事項

- セキュリティ上、パスワードは BMS 定義で `DARK` (非表示) 属性に設定されていることが一般的。
- このプログラムがアプリケーションの唯一の入り口として機能し、COMMAREA の有効性チェックを行うためのキーストーンとなる。

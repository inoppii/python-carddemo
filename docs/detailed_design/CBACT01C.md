# CBACT01C 詳細設計書

## 1. 概要

`CBACT01C` は、アカウントマスタ (`ACCTFILE`) から全レコードを読み込み、複数の異なる形式の順次ファイル（フラットファイル、配列形式、可変長形式）にデータを抽出・変換して出力するプログラムです。主にデータ連携やアーカイブ目的で使用されます。

## 2. プログラム情報

- **プログラム ID**: `CBACT01C`
- **作成者**: AWS
- **タイプ**: BATCH COBOL Program
- **関連 JCL**: `ACTEXTRA.jcl` (想定)

## 3. 入出力定義

### 3.1. 入力ファイル

- **ACCTFILE-FILE**: アカウントマスタ (VSAM KSDS)。主入力。

### 3.2. 出力ファイル

- **OUT-FILE**: 固定長アカウント情報 (Sequential)。基本属性を抽出。
- **ARRY-FILE**: 配列形式残高情報 (Sequential)。現在残高やサイクルデビットなどを配列 (`OCCURS`) 形式で出力。
- **VBRC-FILE**: 可変長レコードファイル (Sequential, Recording Mode V)。レコードサイズが異なる 2 種類のレコード (VB1: 12 bytes, VB2: 39 bytes) を混在させて出力。

## 4. 処理ロジック詳細

### 4.1. 主処理ループ

`ACCTFILE` を順次読み込み、各レコードに対して以下の 3 種類の出力処理を並行して実行します。

### 4.2. データ変換と出力

1. **標準抽出 (`1300-POPUL-ACCT-RECORD`)**:
   - `COBDATFT` (アセンブラまたは別 COBOL プログラム) を呼び出し、再発行日 (`ACCT-REISSUE-DATE`) のフォーマット変換を行います。
   - `OUT-FILE` へ書き込みます。
2. **配列形式抽出 (`1400-POPUL-ARRAY-RECORD`)**:
   - アカウント ID と複数の金額フィールドを `OCCURS 5` の配列構造へセットします（現在はデモ用の固定値も含まれる）。
   - `ARRY-FILE` へ書き込みます。
3. **可変長抽出 (`1500-POPUL-VBRC-RECORD`)**:
   - 1 つのアカウントレコードに対し、以下の 2 つを連続して出力します。
     - `VB1` (12 bytes): ID とステータス。
     - `VB2` (39 bytes): ID、残高、限度額、再発行年。
   - `WS-RECD-LEN` を動的に変更しながら `VBRC-FILE` へ書き込みます。

## 5. エラーハンドリング

- ファイルオープン/読込/書込エラー時は、エラー詳細を表示してアベンド (`CEE3ABD`) します。

## 6. 特記事項

- 可変長レコードの書き出し (`RECORDING MODE IS V`) は、メインフレーム固有のファイル特性をシミュレートしており、移行時のテストケースとして重要です。
- 日付フォーマット変換プログラム `COBDATFT` への外部呼び出しを含んでいます。

# COUSR00C 詳細設計書

## 1. 概要

`COUSR00C` は、システムに登録されているユーザーの一覧を表示する CICS オンラインプログラムです。
`USRSEC` ファイルをブラウズし、ページネーション機能（前頁/次頁）を提供します。また、一覧からユーザーを選択して、更新 (`COUSR02C`) や削除 (`COUSR03C`) 画面へ遷移することができます。

## 2. プログラム情報

- **プログラム ID**: `COUSR00C`
- **作成者**: AWS
- **タイプ**: CICS COBOL, VSAM, BMS
- **トランザクション ID**: `CU00`
- **マップセット**: `COUSR00`
- **マップ名**: `COUSR0A`

## 3. 入出力定義

### 3.1. 画面 (BMS)

- **マップセット**: `COUSR00`
- **主要フィールド**:
  - **一覧表示 (配列)**: 最大10件表示。
    - `SEL0001I` ~ `SEL0010I`: 選択フィールド ('U': 更新, 'D': 削除)。
    - `USRID01I` ~ `USRID10I`: ユーザー ID。
    - `FNAME01I` / `LNAME01I`: 氏名。
    - `UTYPE01I`: ユーザータイプ。
  - **ページング情報**: `PAGENUMI` (現在のページ番号)。

### 3.2. VSAM ファイル

- **USRSEC**: ユーザーセキュリティファイル。`STARTBR`, `READNEXT`, `READPREV` を使用。

### 3.3. COMMAREA

- **ページング制御**:
  - `CDEMO-CU00-USRID-FIRST`: ページ先頭のユーザーID。
  - `CDEMO-CU00-USRID-LAST`: ページ末尾のユーザーID。
  - `CDEMO-CU00-PAGE-NUM`: 現在のページ番号。
- **選択状態**:
  - `CDEMO-CU00-USR-SEL-FLG`: 選択アクション ('U' or 'D')。
  - `CDEMO-CU00-USR-SELECTED`: 選択されたユーザーID。

## 4. 処理ロジック詳細

### 4.1. 初期表示 (MAIN-PARA)

- 初回起動時は `STARTBR` でファイルの先頭から読み込みを開始し、最初の10件を表示。
- 他画面からの戻り時は、COMMAREA のページ情報を元に再表示などの制御を行う。

### 4.2. ページング処理

- **次ページ (`PROCESS-PAGE-FORWARD` / F8)**:
  - 前ページの最後のキー (`CDEMO-CU00-USRID-LAST`) から `READNEXT` で読み進める。
- **前ページ (`PROCESS-PAGE-BACKWARD` / F7)**:
  - 現在ページの先頭キー (`CDEMO-CU00-USRID-FIRST`) から `READPREV` で読み戻る論理（またはページ番号管理による再検索）。
  - 1ページ目の場合は「これ以上戻れません」メッセージを表示。

### 4.3. アクション選択 (`PROCESS-ENTER-KEY`)

- ユーザーが一覧の左端にある選択フィールド（SEL）に文字を入力して Enter を押下。
- **'U' (Update)**:
  - 選択されたユーザー ID を COMMAREA に設定し、`COUSR02C` へ `XCTL`。
- **'D' (Delete)**:
  - 選択されたユーザー ID を COMMAREA に設定し、`COUSR03C` へ `XCTL`。
- **その他**:
  - 無効な値が入力された場合はエラーメッセージを表示。

## 5. エラーハンドリング

- **ファイル終端 (EOF)**: 次ページがない場合、「Bottom of page」メッセージを表示。
- **複数選択チェック**: 仕様上、一度に1件の処理遷移しか行わないよう実装されている（ループで最初の有効な選択を処理）。

# COCRDSLC 詳細設計書

## 1. 概要

`COCRDSLC` は、特定のクレジットカードの詳細情報を照会・表示する CICS オンラインプログラムです。
ユーザーはアカウント ID とカード番号を入力して情報を検索します。また、`COCRDLIC` (一覧画面) から遷移して特定カードの詳細を表示する場合もあります。

## 2. プログラム情報

- **プログラム ID**: `COCRDSLC`
- **作成者**: AWS
- **タイプ**: CICS COBOL, VSAM, BMS
- **トランザクション ID**: `CCDL`
- **マップセット**: `COCRDSL`
- **マップ名**: `CCRDSLA`

## 3. 入出力定義

### 3.1. 画面 (BMS)

- **マップセット**: `COCRDSL`
- **主要フィールド**:
  - **入力**: `ACCTSIDA` (Account ID), `CARDSIDA` (Card Number)。
  - **出力**:
    - `CRDNAMEO`: カード名義人 (Name Embossed)。
    - `CRDSTCDO`: ステータス (Active Status)。
    - `EXPMONO` / `EXPYEARO`: 有効期限 (月/年)。
    - `ERRMSGO`: エラーメッセージ表示エリア。

### 3.2. VSAM ファイル

- **CARDDAT**: カード情報マスター。
- **CARDAIX**: アカウント ID からカードを引くための Alternate Index。

## 4. 処理ロジック詳細

### 4.1. 初期表示 (MAIN-PARA)

- `COMMAREA` をチェック。他のプログラム (`COCRDLIC` 等) から Account ID / Card Number が渡されている場合、即座に検索処理を実行 (`9000-READ-DATA`)。
- 渡されていない場合、検索キーの入力待ち状態とする。

### 4.2. データ取得 (9000-READ-DATA)

- **入力チェック**: アカウント ID とカード番号が正しく入力されているかを検証。
- **検索ロジック (9100-GETCARD-BYACCTCARD)**:
  - 基本的には `Card Number` をプライマリキーとして `CARDDAT` を検索 (`READ`).
  - レコードが見つからない場合 (`NOTFND`)、エラーを表示。
- **クロスリファレンス検索 (9150-GETCARD-BYACCT)**:
  - (注: ソースコード上、`9150-GETCARD-BYACCT` も定義されているが、メインフローでの呼び出し優先度はカード番号指定検索。アカウント ID しか分からない場合の検索用ロジックとして存在する可能性が高い)。

### 4.3. 画面表示

- 取得したカード情報（名義人、有効期限、ステータスなど）を画面項目にマッピングし表示。
- アカウント ID やカード番号などの入力フィールドは、誤操作防止のため出力専用（あるいは保護属性）に切り替える制御が含まれる場合がある。

## 5. エラーハンドリング

- **入力エラー**: 必須項目未入力、数値フォーマットエラーなどをチェック。
- **データ不在**: 指定されたキーに対応するカードが存在しない場合のエラーハンドリング。
- **ファイルエラー**: VSAM 読み込み時のその他のエラー (`RESP` コード) のハンドリング。

## 6. 特記事項

- **コンテキスト維持**: 画面遷移間で検索キー (`Account ID`, `Card Number`) を COMMAREA で引き継ぐことで、ユーザービリティを向上させている。
